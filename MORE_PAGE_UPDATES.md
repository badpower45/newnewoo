# ุชุญุฏูุซุงุช ุตูุญุฉ "ุงููุฒูุฏ" (More Page)

## ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### 1. ุฅุตูุงุญ ุงูุฑูุงุจุท ูู MorePage
- โ **ุทูุจุงุชู**: ุชู ุชุบููุฑ ุงูุฑุงุจุท ูู `/orders` ุฅูู `/my-orders`
- โ **ุจุทุงูุงุช ุงูุฏูุน**: ุชู ุญุฐู ูุฐุง ุงูุฎูุงุฑ ุจุงููุงูู
- โ **ุฅุฑุณุงู ุงูุงูุชุฑุงุญ**: ููุฌู ุงูุขู ุฅูู `/chat` (ุฎุฏูุฉ ุงูุนููุงุก)
- โ **ุทูุจ ุงููุณุงุนุฏุฉ**: ููุฌู ุงูุขู ุฅูู `/chat` (ุฎุฏูุฉ ุงูุนููุงุก)

### 2. ุงูุตูุญุงุช ุงูุฌุฏูุฏุฉ

#### ุฃ. ุตูุญุฉ ููุงุท ุงูููุงุก (`/loyalty`)
**ุงููููุฒุงุช:**
- ุนุฑุถ ุฑุตูุฏ ุงูููุงุท ุงูุญุงูู
- ูููุฉ ุงูููุงุท ุจุงูุฌููู (1 ููุทุฉ = 1 ุฌููู)
- ุดุฑุญ ููููุฉ ูุณุจ ุงูููุงุท
- ุณุฌู ูุงูู ูุฌููุน ูุนุงููุงุช ุงูููุงุท
- ุชุตููู ุฌุฐุงุจ ุจุฃููุงู ุฐูุจูุฉ

**ุงูููู:** `pages/LoyaltyPage.tsx`

#### ุจ. ุตูุญุฉ ุงูุนูุงููู (`/addresses`)
**ุงููููุฒุงุช:**
- ุนุฑุถ ุฌููุน ุนูุงููู ุงููุณุชุฎุฏู
- ุฅุถุงูุฉ ุนููุงู ุฌุฏูุฏ (ููุฒู / ุนูู / ุขุฎุฑ)
- ุชุนุฏูู ูุญุฐู ุงูุนูุงููู
- ุชุญุฏูุฏ ุนููุงู ุงูุชุฑุงุถู
- ูููุฐุฌ ููุตู ูุน ุฌููุน ุงูุจูุงูุงุช ุงููุทููุจุฉ

**ุงูููู:** `pages/AddressesPage.tsx`

#### ุฌ. ุตูุญุฉ ุงููุฑูุน (`/branches`)
**ุงููููุฒุงุช:**
- ุนุฑุถ ุฌููุน ุงููุฑูุน ุงููุดุทุฉ
- ููุชุฑุฉ ุญุณุจ ุงููุญุงูุธุฉ
- ุนุฑุถ ุชูุงุตูู ูู ูุฑุน (ุงูุนููุงูุ ุงููุงุชูุ ุณุงุนุงุช ุงูุนูู)
- ุฒุฑ "ุงููุตูู ูููุฑุน" ููุชุญ ุฎุฑุงุฆุท ุฌูุฌู
- ุฒุฑ ููุงุชุตุงู ูุจุงุดุฑุฉ

**ุงูููู:** `pages/BranchesPage.tsx`

### 3. ุงูุชุญุฏูุซุงุช ูู ุงูุจุงู ุฅูุฏ

#### ุฃ. ูุงุนุฏุฉ ุงูุจูุงูุงุช
**ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ:**
```sql
-- ุฅุถุงูุฉ ุนููุฏ ุงูููุงุท ูุฌุฏูู ุงููุณุชุฎุฏููู
ALTER TABLE users ADD COLUMN loyalty_points INTEGER DEFAULT 0;

-- ุฌุฏูู ุงูุนูุงููู
CREATE TABLE addresses (
    id, user_id, type, address_line1, address_line2,
    city, governorate, postal_code, phone, is_default, 
    created_at, updated_at
);

-- ุฌุฏูู ุณุฌู ููุงุท ุงูููุงุก
CREATE TABLE loyalty_points_history (
    id, user_id, order_id, points, type, 
    description, created_at
);
```

**ููู SQL:** `database_migrations/loyalty_addresses.sql`

#### ุจ. API Routes ุงูุฌุฏูุฏุฉ

**1. Addresses Routes (`server/routes/addresses.js`)**
- `GET /api/addresses?userId=X` - ุฌูุจ ุนูุงููู ุงููุณุชุฎุฏู
- `POST /api/addresses` - ุฅุถุงูุฉ ุนููุงู ุฌุฏูุฏ
- `PUT /api/addresses/:id` - ุชุนุฏูู ุนููุงู
- `DELETE /api/addresses/:id` - ุญุฐู ุนููุงู
- `PUT /api/addresses/:id/set-default` - ุฌุนู ุนููุงู ุงูุชุฑุงุถู

**2. Loyalty Routes (`server/routes/loyalty.js`)**
- `GET /api/loyalty/transactions?userId=X` - ุฌูุจ ุณุฌู ุงูููุงุท
- `GET /api/loyalty/balance?userId=X` - ุฌูุจ ุฑุตูุฏ ุงูููุงุท

**3. Users Routes (ุชุญุฏูุซ)**
- `GET /api/users/profile` - ุฌูุจ ุจุฑููุงูู ุงููุณุชุฎุฏู ุงูุญุงูู (ูุน ุงูููุงุท)

#### ุฌ. ูุธุงู ุงูููุงุท ุงูุชููุงุฆู
ุชู ุชุญุฏูุซ `server/routes/orders.js`:
- ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ ุฅูู `delivered`
- ูุชู ุญุณุงุจ ุงูููุงุท = ุฅุฌูุงูู ูููุฉ ุงูุทูุจ
- ุฅุถุงูุฉ ุงูููุงุท ุฅูู ุญุณุงุจ ุงููุณุชุฎุฏู ุชููุงุฆูุงู
- ุชุณุฌูู ุงููุนุงููุฉ ูู `loyalty_points_history`

### 4. Frontend API Service
ุชู ุฅุถุงูุฉ methods ุฌุฏูุฏุฉ ูู `services/api.ts`:

```typescript
api.addresses.getAll(userId)
api.addresses.create(data)
api.addresses.update(id, data)
api.addresses.delete(id)
api.addresses.setDefault(id)

api.loyalty.getTransactions(userId)

api.users.getProfile()
```

### 5. Routes ูู App.tsx
ุชู ุฅุถุงูุฉ:
```tsx
<Route path="/loyalty" element={<ProtectedRoute><LoyaltyPage /></ProtectedRoute>} />
<Route path="/addresses" element={<ProtectedRoute><AddressesPage /></ProtectedRoute>} />
<Route path="/branches" element={<BranchesPage />} />
```

## ุฎุทูุงุช ุงูุชุดุบูู

### 1. ุชุทุจูู ุชุบููุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
ูู ุจุชุดุบูู ุงูุณูุฑูุจุช SQL ุนูู ูุงุนุฏุฉ ุจูุงูุงุช Supabase:
```bash
# ุงูุชุญ Supabase SQL Editor ูููุฐ ูุญุชูู ุงูููู:
database_migrations/loyalty_addresses.sql
```

### 2. ุชุซุจูุช ุงูุชุจุนูุงุช (ุฅุฐุง ูุฒู ุงูุฃูุฑ)
```bash
npm install
```

### 3. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ
```bash
cd server
npm run dev
```

### 4. ุฅุนุงุฏุฉ ุชุดุบูู Frontend
```bash
npm run dev
```

## ุงูุงุฎุชุจุงุฑ

### ุตูุญุฉ "ุงููุฒูุฏ" (More)
1. ุงูุชุญ ุงูุชุทุจูู ูุงูุชูู ุฅูู ุชุจููุจ "ุงููุฒูุฏ"
2. ุชุฃูุฏ ูู ุนูู ุฌููุน ุงูุฑูุงุจุท:
   - โ ุทูุจุงุชู โ ุชุนุฑุถ ุทูุจุงุช ุงููุณุชุฎุฏู
   - โ ููุงุทู โ ุชุนุฑุถ ุตูุญุฉ ุงูููุงุท
   - โ ุงูุนูุงููู โ ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุนูุงููู
   - โ ูุฑูุนูุง โ ูุงุฆูุฉ ุงููุฑูุน
   - โ ุฅุฑุณุงู ุงูุงูุชุฑุงุญ โ ูุญุงุฏุซุฉ ุฎุฏูุฉ ุงูุนููุงุก
   - โ ุทูุจ ุงููุณุงุนุฏุฉ โ ูุญุงุฏุซุฉ ุฎุฏูุฉ ุงูุนููุงุก

### ูุธุงู ุงูููุงุท
1. ูู ุจุนูู ุทูุจ ููุณุชุฎุฏู ุนุงุฏู
2. ูู ููุญุฉ ุงูุชูุฒูุนุ ูุฒุน ุงูุทูุจ ุนูู ุฏููููุฑู
3. ูู ุชุทุจูู ุงูุฏููููุฑูุ ุบูุฑ ุญุงูุฉ ุงูุทูุจ ุฅูู "ุชู ุงูุชูุตูู"
4. ุงุฑุฌุน ูููุณุชุฎุฏู ูุงูุชุญ ุตูุญุฉ "ููุงุทู"
5. ูุฌุจ ุฃู ุชุฑู ุงูููุงุท ูุถุงูุฉ = ุฅุฌูุงูู ูููุฉ ุงูุทูุจ

### ุตูุญุฉ ุงูุนูุงููู
1. ุงูุชุญ "ุงูุนูุงููู" ูู ุตูุญุฉ ุงููุฒูุฏ
2. ุงุถุบุท "+" ูุฅุถุงูุฉ ุนููุงู ุฌุฏูุฏ
3. ุงููุฃ ุงููููุฐุฌ ูุงุญูุธ
4. ุฌุฑุจ ุชุนุฏูู ูุญุฐู ุงูุนูุงููู
5. ุฌุฑุจ ุฌุนู ุนููุงู ุงูุชุฑุงุถู

### ุตูุญุฉ ุงููุฑูุน
1. ุงูุชุญ "ูุฑูุนูุง"
2. ุฌุฑุจ ุงูููุชุฑุฉ ุญุณุจ ุงููุญุงูุธุฉ
3. ุงุถุบุท "ุงููุตูู ูููุฑุน" โ ูุฌุจ ุฃู ููุชุญ ุฎุฑุงุฆุท ุฌูุฌู
4. ุงุถุบุท "ุงุชุตุงู" โ ูุฌุจ ุฃู ููุชุญ ุชุทุจูู ุงููุงุชู

## ููุงุญุธุงุช ูููุฉ

### ุงููุตุงุฏูุฉ (Authentication)
- ุตูุญุฉ ุงูููุงุท ุชุชุทูุจ ุชุณุฌูู ุฏุฎูู (`requireAuth: true`)
- ุตูุญุฉ ุงูุนูุงููู ุชุชุทูุจ ุชุณุฌูู ุฏุฎูู
- ูุญุงุฏุซุฉ ุฎุฏูุฉ ุงูุนููุงุก ุชุชุทูุจ ุชุณุฌูู ุฏุฎูู
- ุตูุญุฉ ุงููุฑูุน ูุง ุชุชุทูุจ ุชุณุฌูู ุฏุฎูู

### ุฃูุงู ุงูุจูุงูุงุช
- ุฌููุน routes ุงูุนูุงููู ูุญููุฉ ุจู `authenticateToken`
- ุงููุณุชุฎุฏู ููููู ููุท ุฑุคูุฉ ูุชุนุฏูู ุนูุงูููู ุงูุฎุงุตุฉ
- ูุธุงู ุงูููุงุท ูุชุทูุจ ูุตุงุฏูุฉ

### ูุนุฏู ุงูููุงุท
ุญุงููุงู: **1 ุฌููู = 1 ููุทุฉ**
ูููู ุชุบููุฑ ุงููุนุฏู ูู:
- `server/routes/orders.js` (ุงูุณุทุฑ 432): `Math.floor(Number(order.total))`
- `pages/LoyaltyPage.tsx` (ุงูุณุทุฑ 54): `getPointsValue()`

## ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

### ุงูุชุฑุงุญุงุช:
1. ุฅููุงููุฉ ุงุณุชุฎุฏุงู ุงูููุงุท ูู ุงูุฏูุน
2. ุนุฑูุถ ุฎุงุตุฉ ูุฃุตุญุงุจ ุงูููุงุท ุงูุนุงููุฉ
3. ูุณุชููุงุช ููุงุก (ุจุฑููุฒุ ูุถูุ ุฐูุจู)
4. ููุงูุขุช ุฎุงุตุฉ ุจููุงุณุจุงุช ูุนููุฉ
5. ุฅุดุนุงุฑุงุช ุนูุฏ ูุณุจ ููุงุท ุฌุฏูุฏุฉ
6. ุฅุถุงูุฉ ุฎุฑูุทุฉ ุชูุงุนููุฉ ูู ุตูุญุฉ ุงููุฑูุน

## ุงููููุงุช ุงููุนุฏูุฉ

### Frontend:
- โ `pages/MorePage.tsx` - ุชุญุฏูุซ ุงูุฑูุงุจุท ูุญุฐู ุจุทุงูุงุช ุงูุฏูุน
- โ `pages/LoyaltyPage.tsx` - **ุฌุฏูุฏ**
- โ `pages/AddressesPage.tsx` - **ุฌุฏูุฏ**
- โ `pages/BranchesPage.tsx` - **ุฌุฏูุฏ**
- โ `App.tsx` - ุฅุถุงูุฉ routes ุฌุฏูุฏุฉ
- โ `services/api.ts` - ุฅุถุงูุฉ API methods

### Backend:
- โ `server/routes/addresses.js` - **ุฌุฏูุฏ**
- โ `server/routes/loyalty.js` - **ุฌุฏูุฏ**
- โ `server/routes/users.js` - ุฅุถุงูุฉ `/profile` route
- โ `server/routes/orders.js` - ูุธุงู ุงูููุงุท ุงูุชููุงุฆู
- โ `server/index.js` - ุชุณุฌูู routes ุฌุฏูุฏุฉ

### Database:
- โ `database_migrations/loyalty_addresses.sql` - **ุฌุฏูุฏ**

---

**ุชู ุงูุงูุชูุงุก ูู ุฌููุน ุงูููุฒุงุช ุงููุทููุจุฉ! ๐**

ุฌููุน ุงูุฑูุงุจุท ูู ุตูุญุฉ "ุงููุฒูุฏ" ุชุนูู ุงูุขู ุจุดูู ุตุญูุญุ ูุชู ุฅุถุงูุฉ ูุธุงู ููุงุท ุงูููุงุก ุงููุงูู ูุน ุงูุชุญุฏูุซ ุงูุชููุงุฆู ุนูุฏ ุงูุชูุตูู.
